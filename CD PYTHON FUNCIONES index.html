import re

def analizar_expresion():
    funcion = input("Ingresa la función (ej: 2*y + x): ").strip()
    vars_funcion = sorted(set(re.findall(r"[a-zA-Z]", funcion)))
    operaciones = re.findall(r"[+\-*/^]", funcion)

    resp = input("¿Deseas ingresar restricciones? (s/n): ").strip().lower()
    restricciones = []
    if resp == "s":
        linea = input("Escribe restricciones separadas por ';' (ej: x>=0; y<=5): ").strip()
        if linea:
            restricciones = [r.strip() for r in linea.split(";") if r.strip()]

    vars_restr = set()
    for rstr in restricciones:
        vars_restr.update(re.findall(r"[a-zA-Z]", rstr))

    variables = sorted(set(vars_funcion) | vars_restr)

    if len(variables) > 2:
        print("\n⚠️ Se detectaron más de 2 variables:", variables)
        print("Este programa está pensado para máximo 2 variables.\n")

    terminos = re.findall(r"[+-]?\s*\d*\s*\*?\s*[a-zA-Z]", funcion)

    patron_rel = re.compile(r"(<=|>=|<|>|=)")
    restricciones_validas = []
    restricciones_invalidas = []
    for rstr in restricciones:
        if patron_rel.search(rstr):
            restricciones_validas.append(rstr)
        else:
            restricciones_invalidas.append(rstr)

    print("\n===== RESULTADOS =====")
    print(f"Función: {funcion}")
    print(f"Variables detectadas: {variables if variables else 'Ninguna'}")
    print(f"Términos (descomposición simple): {terminos if terminos else 'Ninguno'}")
    print(f"Operaciones encontradas: {operaciones if operaciones else 'Ninguna'}")

    if restricciones:
        print("\nRestricciones ingresadas:")
        for r in restricciones:
            print(" -", r)
        if restricciones_invalidas:
            print("\n⚠️ Restricciones con formato no reconocido:")
            for r in restricciones_invalidas:
                print(" -", r)

if __name__ == "__main__":
    analizar_expresion()

